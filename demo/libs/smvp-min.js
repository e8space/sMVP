var SMVP=function(){function t(e){t.namespace=e,new this.Helper,_dataGateway=new this.DataGatewayMock,this.getDataGateway=function(){return _dataGateway},this.setDataGateway=function(t){_dataGateway=t}}return t.prototype.Model=function(){function e(t){var e=this;this.properties=t||{},this.setGettersSetters=function(t){jQuery.extend(e.properties,t);for(var n in t)!function(){var t=n;e["set"+n.ucfirst()]=function(n){return e.properties[t]=n,this},e["get"+n.ucfirst()]=function(){return e.properties[t]}}()},this.setGettersSetters(e.properties)}return e.prototype={clone:function(){return new e(this.getObjectRepresentation())},getObjectRepresentation:function(){var t={};for(obj in this.properties)t[obj]=this["get"+obj.ucfirst()]();return t},setObjectRepresentation:function(t){for(obj in t)this["set"+obj.ucfirst()](t[obj])},getJsonRepresentation:function(){return JSON.stringify(this.properties)},setJsonRepresentation:function(t){var e=JSON.parse(t);for(obj in e)this["set"+obj.ucfirst()](e[obj])},post:function(){try{var t=this,e=_dataGateway.postModel(this.getObjectRepresentation());return jQuery.extend(t.properties,e),$.each(e,function(e,n){if("undefined"==typeof t["get"+e.ucfirst()]){var o={};o[e]=n,t.setGettersSetters(o)}}),this}catch(n){console.log(n)}},fetch:function(){try{return this.setGettersSetters(t.dataGateway.fetchModel(this.getObjectRepresentation())),this}catch(e){console.log(e)}},update:function(){try{return t.dataGateway.updateModel(this.getObjectRepresentation()),this}catch(e){console.log(e)}},destroy:function(){try{return t.dataGateway.deleteModel(this.getObjectRepresentation())}catch(e){console.log(e)}}},e}(),t.prototype.View=function(){function t(t){var e=$("#"+t.getTemplate()).html(),n=t.getContainer(),o=t;this.getTemplate=function(){return e},this.setTemplate=function(t){return e=t,this},this.getContainer=function(){return n},this.setContainer=function(t){return n=t,this},this.getModel=function(){return o},$(n).empty()}return t.prototype={render:function(t,e){$("[id^="+this.getContainer()+"]").html(_.template(this.getTemplate())(t));try{$("#"+this.getContainer()).find("select").select2({placeholder:t.getSelect2Placeholder()})}catch(n){}"undefined"!=typeof e?e():!1},hide:function(){$("#"+this.getContainer()).hide()},show:function(){$("#"+this.getContainer()).show()},destroy:function(){$("#"+this.getContainer()).off().empty(),$.publish("viewDestroyed_"+this.getContainer())}},t}(),t.prototype.Presenter=function(){function e(n,o){var i=this,r=n,s=o,u={};"function"==typeof r.getModel().getSubTriads&&$.each(r.getModel().getSubTriads(),function(n,o){u[o+"Presenter"]=Object.create(e.prototype,{}),e.call(u[o+"Presenter"],new window.SMVP.prototype.View(t.namespace[o+"Model"]),t.namespace[o+"Model"])}),this.getView=function(){return r},this.getModel=function(){return s},this.getSubTriads=function(){return u},$(document).bind("modelChanged_"+i.getModel().getId(),function(){i.renderView.call()})}return e.prototype={setEventDelegate:function(t){var e=this.getModel().getId(),n=$("#"+e).attr("data-event");return $("#"+e).off(n),"undefined"!=typeof n&&$("#"+e).on(n,function(n){t[e+"_event"]({element:n,value:$("#"+e).val()})}),this},removeEventDelegate:function(){var t=this.getModel().getId(),e=$("[data-id="+t+"]").attr("data-event");$("[data-id="+t+"]").off(e,self.handler)},renderView:function(t,e){var n=this,o=e||n;return this.getView().render(this.getModel(),function(){n.setEventDelegate(o);var e=n.getSubTriads(),i=Object.keys(e).length;0==i?t():!1;for(var r in e)(function(){e[r].renderView(function(){i--},o),0==i?t():!1})()}),this},hideView:function(){this.getView().hide()},showView:function(){this.getView().show()},destroyView:function(){var t=this,e=t.getSubTriads();for(triad in e)t[e[triad]+"_presenter"].destroyView();t.removeEventDelegate(),this.getView().destroy(),$(document).trigger("destroyView_"+this.getModel().getId())}},e}(),t.prototype.DataGatewayMock=function(){function t(){this.postModel=function(t){var e=t.urlRoot.split("/")[1],n=e+(Object.keys(mockData[e]).length+1);return t.id=n,t.link=t.urlRoot+"/"+n,mockData[e][n]=t,mockData[e][n]},this.fetchModel=function(t){var e=t.urlRoot.split("/")[1];return mockData[e][t.id]},this.updateModel=function(t){var e=t.urlRoot.split("/")[1],n=t.id;return mockData[e][n]=t,mockData[e][n]},this.deleteModel=function(t){var e=t.urlRoot.split("/")[1],n=t.id;return delete mockData[e][n],!0},this.postCollection=function(t){$.each(t.getCollection(),function(e,n){mockData[t.getUrlRoot()][e]=n})},this.fetchCollection=function(t){return mockData[t.getUrlRoot()]},this.deleteCollection=function(t){delete mockData[t.getUrlRoot()]}}return t}(),t.prototype.Collection=function(){function t(t){var e=t.getUrlRoot().split("/")[1],n={},o=Object.keys(t.getObjectRepresentation()).sort();this.addModel=function(t){return JSON.stringify(o)==JSON.stringify(Object.keys(t.getObjectRepresentation()))?(n[t.getObjectRepresentation().id]=t.getObjectRepresentation(),!0):!1},this.readModel=function(t){return new Model(n[t])},this.readModels=function(){var t={};return $.each(n,function(e,n){t[e]=new Model(n)}),t},this.getCollection=function(){return n},this.setCollection=function(t){n=t},this.getUrlRoot=function(){return e}}return t.prototype.fetch=function(){var t={},e=smvp.dataGateway.fetchCollection(this);return $.each(e,function(e,n){t[e]=n}),this.setCollection(t),this.getCollection()},t.prototype.post=function(){smvp.dataGateway.postCollection(this)},t}(),t.prototype.Helper=function(){function t(){String.prototype.ucfirst=function(){return this.charAt(0).toUpperCase()+this.substr(1)},guid=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}}(),uuid=function(){var t=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:7&n|8).toString(16)});return e}}return t}(),t.prototype.DataGateway=function(){function t(t){this.postModel=function(e){t.post(e.link,e,function(t){return t})},this.fetchModel=function(e){t.get(e.link,function(t){return t})},this.updateModel=function(e){t.put(e.link,e,function(t){return t})},this.deleteModel=function(e){t.destroy(e.link,function(t){return t})},this.postCollection=function(e){t.post(e.getUrlRoot(),e,function(t){return t})},this.fetchCollection=function(e){t.get(e.getUrlRoot(),function(t){return t})},this.deleteCollection=function(e){t.destroy(e.getUrlRoot(),function(t){return t})}}return t}(),t.prototype.AjaxHandler=function(){function t(){this.executeRequest=function(t,e,n,o){var i=null;"undefined"!=typeof o&&(i=JSON.stringify(o)),$.ajax({type:t,dataType:"json",contentType:"application/json",data:i,url:e,success:function(t){n(t)},error:function(t){alert("Request Status: "+t.status+" Status Text: "+t.statusText+" "+t.responseText)},complete:function(){}})}}return t.prototype.post=function(t,e,n){this.executeRequest("POST",t,n,e)},t.prototype.get=function(t,e){this.executeRequest("GET",t,e)},t.prototype.put=function(t,e,n){this.executeRequest("PUT",t,n,e)},t.prototype.destroy=function(t,e){this.executeRequest("DELETE",t,e)},t}(),t}();