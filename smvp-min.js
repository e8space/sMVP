var SMVP=function(){var t=null,e={setDataGateway:function(e){t=e},Model:function(){function e(t){var e=this;this.properties=t||{},this.cleanProperties=$.extend(!0,{},t),this.setGettersSetters=function(t){jQuery.extend(!0,e.properties,t);for(var n in t)!function(){var t=n;e["set"+n.ucfirst()]=function(n){return e.properties[t]=n,this},e["get"+n.ucfirst()]=function(n){return e.properties[t]}}()},this.updatePropertiesAndAccessors=function(t){jQuery.extend(!0,e.properties,t),$.each(t,function(t,n){if("undefined"==typeof e["get"+t.ucfirst()]){var o={};o[t]=n,e.setGettersSetters(o)}e["set"+t.ucfirst()](n)})},this.setGettersSetters(e.properties)}return e.prototype={clone:function(){return new SMVP.Model(this.getObjectRepresentation())},cloneClean:function(){return new SMVP.Model(this.cleanProperties)},getObjectRepresentation:function(){var t={};for(obj in this.properties)t[obj]=this["get"+obj.ucfirst()]();return t},setObjectRepresentation:function(t){for(obj in t)this["set"+obj.ucfirst()](t[obj])},getJsonRepresentation:function(){return JSON.stringify(this.properties)},setJsonRepresentation:function(t){var e=JSON.parse(t);for(obj in e)this["set"+obj.ucfirst()](e[obj])},post:function(e){try{var n=this;t.postModel(this.getObjectRepresentation(),function(t){201==t.status?n.updatePropertiesAndAccessors(t.data):$(document).trigger("dataGatewayError",{statusCode:t.status,message:t.data}),"undefined"!=typeof e?e(n):!1})}catch(o){console.log(o)}},fetch:function(e){try{var n=this;t.fetchModel(this.getObjectRepresentation(),function(t){200==t.status?n.updatePropertiesAndAccessors(t.data):$(document).trigger("dataGatewayError",{statusCode:t.status,message:t.data}),"undefined"!=typeof e?e(n):!1})}catch(o){console.log(o)}},update:function(e){try{var n=this;t.updateModel(this.getObjectRepresentation(),function(t){200==t.status?!0:$(document).trigger("dataGatewayError",{statusCode:t.status,message:t.data}),"undefined"!=typeof e?e(n):!1})}catch(o){console.log(o)}},destroy:function(e){try{var n=this;t.deleteModel(this.getObjectRepresentation(),function(t){200==t.status?n=null:$(document).trigger("dataGatewayError",{statusCode:t.status,message:t.data}),"undefined"!=typeof e?e(n):!1})}catch(o){console.log(o)}}},e}(),Collection:function(){function e(t,e){var o=t.getUrlRoot().split("/")[1],i={},s={},r=Object.keys(t.getObjectRepresentation()).sort();this.addModel=function(t){return JSON.stringify(r)==JSON.stringify(Object.keys(t.getObjectRepresentation()).sort())?(""!=t.getObjectRepresentation().id?(i[t.getObjectRepresentation().id]=t.getObjectRepresentation(),s[t.getObjectRepresentation().id]=t):(t.setId(n.uuid()),i[t.getId()]=t.getObjectRepresentation(),s[t.getId()]=t),!0):!1},this.readModel=function(t){return"undefined"==typeof s[t]&&("undefined"!=typeof i[t]?s[t]=new SMVP.Model(i[t]):!1),s[t]},this.getModels=function(){return s},this.readModels=function(){return $.isEmptyObject(s)&&$.each(i,function(t,e){s[t]=new SMVP.Model(e)}),s},this.getCollection=function(){return i},this.setCollection=function(t){i=t},this.getUrlRoot=function(){return o}}return e.prototype.post=function(e){var n=this;t.postCollection(this,function(t){200==t.status?n.setCollection(t.data):$(document).trigger("dataGatewayError",{statusCode:t.status,message:"post collection failed"}),"undefined"!=typeof e?e(n):!1})},e.prototype.fetch=function(e){var n=this;t.fetchCollection(this,function(t){200==t.status?n.setCollection(t.data):$(document).trigger("dataGatewayError",{statusCode:t.status,message:"fetch collection failed"}),"undefined"!=typeof e?e(n):!1})},e.prototype.update=function(e){var n=this;t.updateCollection(this,function(t){200==t.status?n.setCollection(t.data):$(document).trigger("dataGatewayError",{statusCode:t.status,message:"update collection failed"}),"undefined"!=typeof e?e(n):!1})},e.prototype.destroy=function(e){t.deleteCollection(this,function(){"undefined"!=typeof e?e(self):!1})},e}(),View:function(){function t(t){var e=$.extend(!0,{},t),n=$("#"+e.getTemplate()).html(),o=e.getContainer();this.getTemplate=function(){return n},this.setTemplate=function(t){return n=t,this},this.getContainer=function(){return o},this.setContainer=function(t){return o=t,this},this.getModel=function(){return e},$(o).empty()}return t.prototype={render:function(t,e){$("[data-container="+this.getContainer()+"]").html(_.template(this.getTemplate())(t));try{$("#"+this.getContainer()).find("select").select2({placeholder:t.getSelect2Placeholder()})}catch(n){}"undefined"!=typeof e?e():!1},hide:function(){$("#"+this.getContainer()).hide()},show:function(){$("#"+this.getContainer()).show()},refresh:function(t,e){$("[id^="+this.getContainer()+"]").find("input").val(""),"undefined"!=typeof e?e():!1},destroy:function(t){$("#"+this.getContainer()).off().empty(),"undefined"!=typeof t?t():!1}},t}(),Presenter:function(){function t(e,n){var o=this,i=e,s=n,r={};"function"==typeof i.getModel().getSubTriads&&$.each(i.getModel().getSubTriads(),function(e,n){r[n+"Presenter"]=Object.create(t.prototype,{}),t.call(r[n+"Presenter"],new SMVP.View(SMVP[n+"Model"]),SMVP[n+"Model"])}),this.getView=function(){return i},this.getModel=function(){return s},this.getSubTriads=function(){return r},$(document).bind("modelChanged_"+o.getModel().getId(),function(t,e){o.renderView.call()}),$(document).bind("collectionChanged_"+o.getModel().getId(),function(t,e){o.renderView()})}return t.prototype={setEventDelegate:function(t){var e=this.getModel().getId(),n=$("#"+e).attr("data-event");return $("#"+e).off(n),"undefined"!=typeof n&&$("#"+e).on(n,function(n){t[e+"_event"]({element:n,value:$("#"+e).val(),targetValue:n.target.value})}),this},removeEventDelegate:function(){var t=this.getModel().getId(),e=$("[data-id="+t+"]").attr("data-event");$("#"+t).off(e)},renderView:function(t,e){var n=this;return this.getView().render(this.getModel(),function(){n.setEventDelegate(t);var o=n.getSubTriads(),i=Object.keys(o).length;0==i&&"undefined"!=typeof e&&e();for(var s in o)(function(){o[s].renderView(t,function(){i--}),0==i&&"undefined"!=typeof e&&e()})()}),this},hideView:function(){this.getView().hide()},showView:function(){this.getView().show()},destroyView:function(t){this.removeEventDelegate(),this.getView().destroy(),"undefined"!=typeof t?t():!1},refreshView:function(t){var e=this;this.getView().refresh(this.getModel(),function(){var n=e.getSubTriads(),o=Object.keys(n).length;0==o&&"undefined"!=typeof t&&t();for(var i in n)(function(){n[i].refreshView(function(){o--}),0==o&&"undefined"!=typeof t&&t()})()})}},t}(),DataGateway:function(){function t(t){this.postModel=function(e){t.post(e.link,e,function(t){return t})},this.fetchModel=function(e){t.get(e.link,function(t){return t})},this.updateModel=function(e){t.put(e.link,e,function(t){return t})},this.deleteModel=function(e){t.destroy(e.link,function(t){return t})},this.postCollection=function(e){t.post(e.getUrlRoot(),e,function(t){return t})},this.fetchCollection=function(e){t.get(e.getUrlRoot(),function(t){return t})},this.deleteCollection=function(e){t.destroy(e.getUrlRoot(),function(t){return t})}}return t}(),DataGatewayMock:function(){function t(t){var e=Object.keys(mockData.user).length;this.createResponseObject=function(t,e){return{status:t,data:e}},this.postModel=function(t,n){try{var o=t.urlRoot.split("/")[1],i=o+ ++e;t.id=i,t.link=t.urlRoot+"/"+i,mockData[o][i]=t,"undefined"!=typeof n?n(this.createResponseObject(201,mockData[o][i])):!1}catch(s){console.log(s),"undefined"!=typeof n?n(this.createResponseObject(400,null)):!1}},this.fetchModel=function(t,e){try{var n=t.urlRoot.split("/")[1];"undefined"!=typeof e?e(this.createResponseObject(200,mockData[n][t.id])):!1}catch(o){console.log(o),"undefined"!=typeof e?e(this.createResponseObject(400,null)):!1}},this.updateModel=function(t,e){try{var n=t.urlRoot.split("/")[1];mockData[n][t.id]=t,"undefined"!=typeof e?e(this.createResponseObject(200,mockData[n][t.id])):!1}catch(o){console.log(o),"undefined"!=typeof e?e(this.createResponseObject(400,null)):!1}},this.deleteModel=function(t,e){try{var n=t.urlRoot.split("/")[1],o=t.id;delete mockData[n][o],"undefined"!=typeof e?e(this.createResponseObject(200,null)):!1}catch(i){console.log(i),"undefined"!=typeof e?e(this.createResponseObject(400,null)):!1}},this.postCollection=function(t,e){try{var n=t.getUrlRoot();mockData[n]={};var o=t.getModels();$.each(t.getModels(),function(t,e){e.setId(n+(Object.keys(mockData[n]).length+1)),e.setLink(n+"/"+e.getId()),delete o[t],o[e.getId()]=e,mockData[n][e.getId()]=e}),"undefined"!=typeof e?e(this.createResponseObject(200,mockData[n])):!1}catch(i){console.log(i),"undefined"!=typeof e?e(this.createResponseObject(400,"post collection failed")):!1}},this.fetchCollection=function(t,e){try{"undefined"!=typeof e?e(this.createResponseObject(200,mockData[t.getUrlRoot()])):!1}catch(n){console.log(n),"undefined"!=typeof e?e(this.createResponseObject(400,"fetch collection failed")):!1}},this.updateCollection=function(t,e){try{var n=t.getUrlRoot();mockData[n]={},$.each(t.getModels,function(t,e){mockData[n][t]=e}),"undefined"!=typeof e?e(this.createResponseObject(200,mockData[n])):!1}catch(o){"undefined"!=typeof e?e(this.createResponseObject(400,"update collection failed")):!1}},this.deleteCollection=function(t,e){try{delete mockData[t.getUrlRoot()],"undefined"!=typeof e?e(this.createResponseObject(200,!0)):!1}catch(n){console.log(n),"undefined"!=typeof e?e(this.createResponseObject(400,!1)):!1}}}return t}(),Helper:function(){function t(){String.prototype.ucfirst=function(){return this.charAt(0).toUpperCase()+this.substr(1)}}return t.prototype.uuid=function(){var t=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:7&n|8).toString(16)});return e},t}(),AjaxHandler:function(){function t(){this.executeRequest=function(t,e,n,o){var i=null;"undefined"!=typeof o&&(i=JSON.stringify(o)),$.ajax({type:t,dataType:"json",contentType:"application/json",data:i,url:e,success:function(t){n(t)},error:function(t){alert("Request Status: "+t.status+" Status Text: "+t.statusText+" "+t.responseText)},complete:function(t){}})}}return t.prototype.post=function(t,e,n){this.executeRequest("POST",t,n,e)},t.prototype.get=function(t,e){this.executeRequest("GET",t,e)},t.prototype.put=function(t,e,n){this.executeRequest("PUT",t,n,e)},t.prototype.destroy=function(t,e){this.executeRequest("DELETE",t,e)},t}()},n=new e.Helper;return e}();